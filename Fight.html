<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Combat Titans - Luta</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* RESET E BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000 0%, #111 100%);
            color: white;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
        }
        
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        }
        
        /* CABE√áALHO DA LUTA */
        .fight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.7);
            border-bottom: 2px solid #ff6600;
            z-index: 100;
        }
        
        .level-info {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff6600;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #444;
        }
        
        .back-btn {
            background: #333;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* √ÅREA DA ARENA */
        .arena {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            background: linear-gradient(to bottom, #222 0%, #111 100%);
        }
        
        /* FUNDO DA ARENA */
        .arena-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 102, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 100, 255, 0.1) 0%, transparent 50%);
        }
        
        .arena-floor {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20%;
            background: linear-gradient(to top, #333 0%, #222 100%);
            border-top: 3px solid #ff6600;
        }
        
        .floor-pattern {
            position: absolute;
            top: 0;
            width: 100%;
            height: 20px;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 20px,
                #ff6600 20px,
                #ff6600 40px
            );
        }
        
        /* BARRAS DE VIDA E ENERGIA */
        .health-bars {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 50;
        }
        
        .player-bar, .enemy-bar {
            width: 45%;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-radius: 10px;
            border: 2px solid #444;
        }
        
        .player-name, .enemy-name {
            font-size: 0.9rem;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .health-container {
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .health-fill {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #00ff00, #ffff00, #ff0000);
            transition: width 0.3s;
        }
        
        .energy-container {
            height: 4px;
            background: #222;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .energy-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #00ccff, #0066ff);
            transition: width 0.5s;
        }
        
        /* PERSONAGENS */
        .character {
            position: absolute;
            bottom: 20%;
            transition: all 0.1s;
            z-index: 20;
        }
        
        .player {
            left: 20%;
            transform: scaleX(1); /* Virado para direita */
        }
        
        .enemy {
            right: 20%;
            transform: scaleX(-1); /* Virado para esquerda */
        }
        
        /* ANATOMIA DO PERSONAGEM - ESTILO SHADOW FIGHT */
        .character-body {
            position: relative;
            width: 60px;
            height: 180px;
        }
        
        /* CABE√áA */
        .head {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 45px;
            background: linear-gradient(to bottom, #ffcc99, #e6b891);
            border-radius: 50% 50% 40% 40%;
            z-index: 30;
            box-shadow: inset -3px -3px 5px rgba(0,0,0,0.3);
        }
        
        /* TRONCO */
        .torso {
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 80px;
            background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
            border-radius: 20px 20px 10px 10px;
            z-index: 25;
        }
        
        /* BRA√áOS */
        .arm {
            position: absolute;
            top: 50px;
            z-index: 24;
            transform-origin: top center;
        }
        
        .left-arm {
            left: -15px;
        }
        
        .right-arm {
            right: -15px;
        }
        
        .upper-arm {
            width: 15px;
            height: 50px;
            background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
            border-radius: 7px;
            position: relative;
        }
        
        .forearm {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 40px;
            background: linear-gradient(to bottom, #1a1a1a, #2a2a2a);
            border-radius: 6px;
        }
        
        .hand {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 12px;
            background: linear-gradient(to bottom, #ffcc99, #e6b891);
            border-radius: 50% 50% 30% 30%;
        }
        
        /* PERNAS */
        .leg {
            position: absolute;
            top: 120px;
            z-index: 23;
            transform-origin: top center;
        }
        
        .left-leg {
            left: 5px;
        }
        
        .right-leg {
            right: 5px;
        }
        
        .thigh {
            width: 18px;
            height: 50px;
            background: linear-gradient(to bottom, #1a1a1a, #2a2a2a);
            border-radius: 9px;
            position: relative;
        }
        
        .calf {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 50px;
            background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
            border-radius: 7px;
        }
        
        .foot {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 10px;
            background: linear-gradient(to bottom, #333, #222);
            border-radius: 10px 10px 0 0;
        }
        
        /* EFEITOS DE ATAQUE */
        .punch-effect, .kick-effect, .fireball-effect {
            position: absolute;
            pointer-events: none;
            z-index: 40;
        }
        
        .punch-effect {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,100,0,0) 70%);
            border-radius: 50%;
            animation: punch-glow 0.2s;
        }
        
        @keyframes punch-glow {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .kick-effect {
            width: 40px;
            height: 20px;
            background: linear-gradient(90deg, rgba(255,255,255,0.8) 0%, rgba(255,150,0,0) 100%);
            border-radius: 10px;
            animation: kick-glow 0.3s;
        }
        
        @keyframes kick-glow {
            0% { transform: scaleX(0); opacity: 1; }
            100% { transform: scaleX(1); opacity: 0; }
        }
        
        .fireball {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ff6600 0%, #ff3300 50%, transparent 70%);
            border-radius: 50%;
            box-shadow: 0 0 20px #ff6600;
            animation: fireball-move 1s linear;
        }
        
        @keyframes fireball-move {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }
        
        /* CONTROLES */
        .controls {
            height: 30%;
            background: rgba(0, 0, 0, 0.8);
            border-top: 3px solid #ff6600;
            display: flex;
            padding: 15px;
            gap: 10px;
        }
        
        /* CONTROLES DE MOVIMENTO (ESQUERDA) */
        .movement-controls {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
        }
        
        .movement-btn {
            background: rgba(50, 50, 50, 0.9);
            border: 2px solid #666;
            border-radius: 15px;
            color: white;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            touch-action: manipulation;
        }
        
        .movement-btn:active {
            background: rgba(100, 100, 100, 0.9);
            transform: scale(0.95);
        }
        
        .jump-btn { grid-column: 2; grid-row: 1; }
        .crouch-btn { grid-column: 2; grid-row: 2; }
        .forward-btn { grid-column: 3; grid-row: 2; }
        .backward-btn { grid-column: 1; grid-row: 2; }
        
        /* CONTROLES DE ATAQUE (DIREITA) */
        .attack-controls {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
        }
        
        .attack-btn {
            background: linear-gradient(145deg, #444, #222);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
        }
        
        .attack-btn:active {
            transform: scale(0.95);
        }
        
        .attack-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .attack-label {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .punch-btn {
            background: linear-gradient(145deg, #cc3300, #992200);
            border: 2px solid #ff5500;
        }
        
        .kick-btn {
            background: linear-gradient(145deg, #0088cc, #006699);
            border: 2px solid #00aaff;
        }
        
        .magic-btn {
            grid-column: span 2;
            background: linear-gradient(145deg, #8800cc, #660099);
            border: 2px solid #aa00ff;
        }
        
        .magic-btn.ready {
            animation: magic-ready 1s infinite alternate;
        }
        
        @keyframes magic-ready {
            0% { box-shadow: 0 0 10px #aa00ff; }
            100% { box-shadow: 0 0 20px #aa00ff, 0 0 30px #ff00ff; }
        }
        
        /* MENSAGENS DO JOGO */
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            color: #ff6600;
            text-shadow: 0 0 20px #ff0000;
            opacity: 0;
            z-index: 100;
            pointer-events: none;
        }
        
        .win-message {
            color: #00ff00;
            text-shadow: 0 0 20px #00ff00;
        }
        
        .lose-message {
            color: #ff0000;
            text-shadow: 0 0 20px #ff0000;
        }
        
        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .character-body {
                width: 50px;
                height: 150px;
            }
            
            .head {
                width: 30px;
                height: 35px;
            }
            
            .torso {
                top: 35px;
                width: 40px;
                height: 60px;
            }
            
            .arm {
                top: 40px;
            }
            
            .upper-arm {
                width: 12px;
                height: 40px;
            }
            
            .forearm {
                width: 10px;
                height: 30px;
            }
            
            .leg {
                top: 90px;
            }
            
            .thigh {
                width: 15px;
                height: 40px;
            }
            
            .calf {
                width: 12px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- CABE√áALHO -->
        <div class="fight-header">
            <button class="back-btn" onclick="returnToLevelSelect()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="level-info" id="levelInfo">N√çVEL 1</div>
            <div class="timer" id="timer">99</div>
        </div>
        
        <!-- √ÅREA DA ARENA -->
        <div class="arena">
            <!-- FUNDO -->
            <div class="arena-background"></div>
            <div class="arena-floor">
                <div class="floor-pattern"></div>
            </div>
            
            <!-- BARRAS DE VIDA -->
            <div class="health-bars">
                <div class="player-bar">
                    <div class="player-name">PLAYER</div>
                    <div class="health-container">
                        <div class="health-fill" id="playerHealth" style="width: 100%"></div>
                    </div>
                    <div class="energy-container">
                        <div class="energy-fill" id="playerEnergy" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="enemy-bar">
                    <div class="enemy-name" id="enemyName">IA B√ÅSICA</div>
                    <div class="health-container">
                        <div class="health-fill" id="enemyHealth" style="width: 100%"></div>
                    </div>
                    <div class="energy-container">
                        <div class="energy-fill" id="enemyEnergy" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <!-- PERSONAGEM JOGADOR -->
            <div class="character player" id="player">
                <div class="character-body">
                    <div class="head"></div>
                    <div class="torso"></div>
                    <div class="arm left-arm">
                        <div class="upper-arm">
                            <div class="forearm">
                                <div class="hand"></div>
                            </div>
                        </div>
                    </div>
                    <div class="arm right-arm" id="playerRightArm">
                        <div class="upper-arm">
                            <div class="forearm">
                                <div class="hand"></div>
                            </div>
                        </div>
                    </div>
                    <div class="leg left-leg">
                        <div class="thigh">
                            <div class="calf">
                                <div class="foot"></div>
                            </div>
                        </div>
                    </div>
                    <div class="leg right-leg" id="playerRightLeg">
                        <div class="thigh">
                            <div class="calf">
                                <div class="foot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PERSONAGEM INIMIGO (IA) -->
            <div class="character enemy" id="enemy">
                <div class="character-body">
                    <div class="head"></div>
                    <div class="torso"></div>
                    <div class="arm left-arm">
                        <div class="upper-arm">
                            <div class="forearm">
                                <div class="hand"></div>
                            </div>
                        </div>
                    </div>
                    <div class="arm right-arm" id="enemyRightArm">
                        <div class="upper-arm">
                            <div class="forearm">
                                <div class="hand"></div>
                            </div>
                        </div>
                    </div>
                    <div class="leg left-leg">
                        <div class="thigh">
                            <div class="calf">
                                <div class="foot"></div>
                            </div>
                        </div>
                    </div>
                    <div class="leg right-leg" id="enemyRightLeg">
                        <div class="thigh">
                            <div class="calf">
                                <div class="foot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- MENSAGENS -->
            <div class="message" id="message">FIGHT!</div>
        </div>
        
        <!-- CONTROLES -->
        <div class="controls">
            <!-- CONTROLES DE MOVIMENTO -->
            <div class="movement-controls">
                <button class="movement-btn jump-btn" id="jumpBtn">
                    <i class="fas fa-arrow-up"></i>
                </button>
                <button class="movement-btn crouch-btn" id="crouchBtn">
                    <i class="fas fa-arrow-down"></i>
                </button>
                <button class="movement-btn forward-btn" id="forwardBtn">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="movement-btn backward-btn" id="backwardBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            
            <!-- CONTROLES DE ATAQUE -->
            <div class="attack-controls">
                <button class="attack-btn punch-btn" id="punchBtn">
                    <div class="attack-icon">üëä</div>
                    <div class="attack-label">SOCAR</div>
                </button>
                <button class="attack-btn kick-btn" id="kickBtn">
                    <div class="attack-icon">ü¶µ</div>
                    <div class="attack-label">CHUTAR</div>
                </button>
                <button class="attack-btn magic-btn" id="magicBtn">
                    <div class="attack-icon">üî•</div>
                    <div class="attack-label">MAGIA (100%)</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO DO JOGO
        // ============================================
        
        // Obter n√≠vel da URL
        const urlParams = new URLSearchParams(window.location.search);
        const currentLevel = parseInt(urlParams.get('level')) || 1;
        
        // Configura√ß√µes baseadas no n√≠vel
        const levelConfigs = {
            1: { enemyName: "IA B√ÅSICA", enemySpeed: 800, enemyHealth: 100, enemyDamage: 5 },
            2: { enemyName: "IA REATIVA", enemySpeed: 700, enemyHealth: 110, enemyDamage: 7 },
            3: { enemyName: "IA PADR√ÉO", enemySpeed: 600, enemyHealth: 120, enemyDamage: 9 },
            4: { enemyName: "IA ADAPTATIVA", enemySpeed: 500, enemyHealth: 130, enemyDamage: 11 },
            5: { enemyName: "IA PREDITIVA", enemySpeed: 450, enemyHealth: 140, enemyDamage: 13 },
            6: { enemyName: "IA ESTRAT√âGICA", enemySpeed: 400, enemyHealth: 150, enemyDamage: 15 },
            7: { enemyName: "IA DE REFOR√áO", enemySpeed: 350, enemyHealth: 160, enemyDamage: 17 },
            8: { enemyName: "IA NEURAL B√ÅSICA", enemySpeed: 300, enemyHealth: 170, enemyDamage: 19 },
            9: { enemyName: "IA NEURAL AVAN√áADA", enemySpeed: 250, enemyHealth: 180, enemyDamage: 21 },
            10: { enemyName: "IA DE APRENDIZADO", enemySpeed: 200, enemyHealth: 190, enemyDamage: 23 },
            11: { enemyName: "IA PROFUNDA", enemySpeed: 180, enemyHealth: 200, enemyDamage: 25 },
            12: { enemyName: "IA GENERATIVA", enemySpeed: 160, enemyHealth: 210, enemyDamage: 27 },
            13: { enemyName: "IA AUT√îNOMA", enemySpeed: 140, enemyHealth: 220, enemyDamage: 29 },
            14: { enemyName: "IA QU√ÇNTICA", enemySpeed: 120, enemyHealth: 230, enemyDamage: 31 },
            15: { enemyName: "IA ALPHA", enemySpeed: 100, enemyHealth: 250, enemyDamage: 35 }
        };
        
        const config = levelConfigs[currentLevel] || levelConfigs[1];
        
        // ============================================
        // VARI√ÅVEIS DO JOGO
        // ============================================
        
        let gameActive = false;
        let timeLeft = 99;
        let gameTimer;
        
        // Estado do jogador
        let player = {
            health: 100,
            maxHealth: 100,
            energy: 0,
            maxEnergy: 100,
            position: 20, // percentual na tela
            isJumping: false,
            isCrouching: false,
            isBlocking: false
        };
        
        // Estado do inimigo
        let enemy = {
            health: config.enemyHealth,
            maxHealth: config.enemyHealth,
            energy: 0,
            maxEnergy: 100,
            position: 80, // percentual na tela
            isJumping: false,
            isCrouching: false,
            isBlocking: false
        };
        
        // ============================================
        // ELEMENTOS DOM
        // ============================================
        
        const levelInfo = document.getElementById('levelInfo');
        const timerElement = document.getElementById('timer');
        const playerHealth = document.getElementById('playerHealth');
        const playerEnergy = document.getElementById('playerEnergy');
        const enemyHealth = document.getElementById('enemyHealth');
        const enemyEnergy = document.getElementById('enemyEnergy');
        const enemyName = document.getElementById('enemyName');
        const message = document.getElementById('message');
        
        const playerElement = document.getElementById('player');
        const enemyElement = document.getElementById('enemy');
        
        const playerRightArm = document.getElementById('playerRightArm');
        const playerRightLeg = document.getElementById('playerRightLeg');
        const enemyRightArm = document.getElementById('enemyRightArm');
        const enemyRightLeg = document.getElementById('enemyRightLeg');
        
        const jumpBtn = document.getElementById('jumpBtn');
        const crouchBtn = document.getElementById('crouchBtn');
        const forwardBtn = document.getElementById('forwardBtn');
        const backwardBtn = document.getElementById('backwardBtn');
        const punchBtn = document.getElementById('punchBtn');
        const kickBtn = document.getElementById('kickBtn');
        const magicBtn = document.getElementById('magicBtn');
        
        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        
        function initGame() {
            // Configurar interface
            levelInfo.textContent = `N√çVEL ${currentLevel}`;
            enemyName.textContent = config.enemyName;
            
            // Mostrar mensagem inicial
            showMessage("FIGHT!", 2000);
            
            // Iniciar temporizador ap√≥s 2 segundos
            setTimeout(() => {
                gameActive = true;
                startTimer();
                startEnemyAI();
            }, 2000);
            
            // Configurar eventos dos bot√µes
            setupControls();
        }
        
        // ============================================
        // CONTROLES
        // ============================================
        
        function setupControls() {
            // MOVIMENTO
            jumpBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                jump(true);
            });
            
            crouchBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                crouch(true);
            });
            
            crouchBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                crouch(false);
            });
            
            forwardBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                moveForward();
            });
            
            backwardBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                moveBackward();
            });
            
            // ATAQUES
            punchBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                punch();
            });
            
            kickBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                kick();
            });
            
            magicBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (!gameActive) return;
                fireball();
            });
            
            // Eventos para mouse (desenvolvimento)
            jumpBtn.addEventListener('mousedown', () => gameActive && jump(true));
            crouchBtn.addEventListener('mousedown', () => gameActive && crouch(true));
            crouchBtn.addEventListener('mouseup', () => crouch(false));
            forwardBtn.addEventListener('mousedown', () => gameActive && moveForward());
            backwardBtn.addEventListener('mousedown', () => gameActive && moveBackward());
        }
        
        // ============================================
        // FUN√á√ïES DE MOVIMENTO
        // ============================================
        
        function jump(isPlayer = true) {
            const character = isPlayer ? playerElement : enemyElement;
            const state = isPlayer ? player : enemy;
            
            if (state.isJumping || state.isCrouching) return;
            
            state.isJumping = true;
            character.style.bottom = '35%';
            
            // Anima√ß√£o de pulo
            character.style.transition = 'bottom 0.3s, transform 0.3s';
            character.style.transform = `scaleX(${isPlayer ? '1' : '-1'}) translateY(-20px)`;
            
            // Voltar ao ch√£o ap√≥s 0.5s
            setTimeout(() => {
                character.style.bottom = '20%';
                character.style.transform = `scaleX(${isPlayer ? '1' : '-1'}) translateY(0)`;
                
                setTimeout(() => {
                    state.isJumping = false;
                }, 300);
            }, 500);
        }
        
        function crouch(isCrouching, isPlayer = true) {
            const character = isPlayer ? playerElement : enemyElement;
            const state = isPlayer ? player : enemy;
            
            state.isCrouching = isCrouching;
            
            if (isCrouching) {
                character.style.height = '120px';
                character.style.bottom = '15%';
            } else {
                character.style.height = '';
                character.style.bottom = '20%';
            }
        }
        
        function moveForward() {
            if (player.position >= 80) return;
            player.position += 5;
            updatePositions();
            
            playerElement.style.transition = 'left 0.2s';
            playerElement.style.left = `${player.position}%`;
        }
        
        function moveBackward() {
            if (player.position <= 5) return;
            player.position -= 5;
            updatePositions();
            
            playerElement.style.transition = 'left 0.2s';
            playerElement.style.left = `${player.position}%`;
        }
        
        function updatePositions() {
            // Garantir que os personagens n√£o se sobreponham
            const minDistance = 15;
            if (Math.abs(player.position - enemy.position) < minDistance) {
                if (player.position < enemy.position) {
                    enemy.position = player.position + minDistance;
                } else {
                    enemy.position = player.position - minDistance;
                }
                
                enemyElement.style.transition = 'right 0.2s';
                enemyElement.style.right = `${100 - enemy.position}%`;
            }
        }
        
        // ============================================
        // FUN√á√ïES DE ATAQUE
        // ============================================
        
        function punch(isPlayer = true) {
            if (!gameActive) return;
            
            const attacker = isPlayer ? player : enemy;
            const target = isPlayer ? enemy : player;
            const attackerArm = isPlayer ? playerRightArm : enemyRightArm;
            
            // Anima√ß√£o do soco
            attackerArm.style.transform = 'rotate(-60deg)';
            
            // Criar efeito visual
            createPunchEffect(isPlayer);
            
            // Verificar se acertou
            if (checkHit(isPlayer)) {
                const damage = isPlayer ? 10 : config.enemyDamage;
                dealDamage(target, damage, isPlayer);
                
                // Adicionar energia
                if (isPlayer) {
                    player.energy = Math.min(player.energy + 15, player.maxEnergy);
                    updateEnergyBars();
                } else {
                    enemy.energy = Math.min(enemy.energy + 15, enemy.maxEnergy);
                    updateEnergyBars();
                }
            }
            
            // Voltar bra√ßo √† posi√ß√£o normal
            setTimeout(() => {
                attackerArm.style.transform = '';
            }, 200);
        }
        
        function kick(isPlayer = true) {
            if (!gameActive) return;
            
            const attacker = isPlayer ? player : enemy;
            const target = isPlayer ? enemy : player;
            const attackerLeg = isPlayer ? playerRightLeg : enemyRightLeg;
            
            // Anima√ß√£o do chute
            attackerLeg.style.transform = 'rotate(-40deg) translateY(-10px)';
            
            // Criar efeito visual
            createKickEffect(isPlayer);
            
            // Verificar se acertou
            if (checkHit(isPlayer)) {
                const damage = isPlayer ? 15 : config.enemyDamage + 5;
                dealDamage(target, damage, isPlayer);
                
                // Adicionar energia
                if (isPlayer) {
                    player.energy = Math.min(player.energy + 20, player.maxEnergy);
                    updateEnergyBars();
                } else {
                    enemy.energy = Math.min(enemy.energy + 20, enemy.maxEnergy);
                    updateEnergyBars();
                }
            }
            
            // Voltar perna √† posi√ß√£o normal
            setTimeout(() => {
                attackerLeg.style.transform = '';
            }, 300);
        }
        
        function fireball(isPlayer = true) {
            if (!gameActive) return;
            
            const attacker = isPlayer ? player : enemy;
            
            // Verificar se tem energia suficiente
            if (attacker.energy < 100) return;
            
            // Consumir energia
            if (isPlayer) {
                player.energy = 0;
                updateEnergyBars();
                magicBtn.classList.remove('ready');
            } else {
                enemy.energy = 0;
                updateEnergyBars();
            }
            
            // Criar bola de fogo
            createFireball(isPlayer);
            
            // Dano garantido se estiver na dist√¢ncia
            if (Math.abs(player.position - enemy.position) < 30) {
                const damage = 30;
                const target = isPlayer ? enemy : player;
                dealDamage(target, damage, isPlayer);
            }
        }
        
        function createPunchEffect(isPlayer) {
            const effect = document.createElement('div');
            effect.className = 'punch-effect';
            
            const x = isPlayer ? 
                player.position + 10 : 
                100 - enemy.position + 10;
            
            effect.style.left = `${x}%`;
            effect.style.bottom = '30%';
            
            document.querySelector('.arena').appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 200);
        }
        
        function createKickEffect(isPlayer) {
            const effect = document.createElement('div');
            effect.className = 'kick-effect';
            
            const x = isPlayer ? 
                player.position + 15 : 
                100 - enemy.position + 15;
            
            effect.style.left = `${x}%`;
            effect.style.bottom = '15%';
            
            if (!isPlayer) {
                effect.style.transform = 'scaleX(-1)';
            }
            
            document.querySelector('.arena').appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 300);
        }
        
        function createFireball(isPlayer) {
            const fireball = document.createElement('div');            fireball.className = 'fireball-effect';
            fireball.innerHTML = '<div class="fireball"></div>';
            
            // Posi√ß√£o inicial
            const startX = isPlayer ? player.position + 8 : 100 - enemy.position + 8;
            fireball.style.left = `${startX}%`;
            fireball.style.bottom = '25%';
            
            // Dire√ß√£o
            const direction = isPlayer ? 1 : -1;
            
            document.querySelector('.arena').appendChild(fireball);
            
            // Animar movimento
            let position = 0;
            const fireballInterval = setInterval(() => {
                position += 5 * direction;
                fireball.style.left = `${startX + position}%`;
                
                // Verificar colis√£o
                if (Math.abs(position) > 50) {
                    clearInterval(fireballInterval);
                    fireball.remove();
                }
                
                // Verificar se atingiu o oponente
                const targetPosition = isPlayer ? enemy.position : player.position;
                if (Math.abs((startX + position) - targetPosition) < 10) {
                    clearInterval(fireballInterval);
                    fireball.remove();
                    
                    // Efeito de explos√£o
                    const explosion = document.createElement('div');
                    explosion.className = 'punch-effect';
                    explosion.style.width = '60px';
                    explosion.style.height = '60px';
                    explosion.style.left = `${targetPosition}%`;
                    explosion.style.bottom = '25%';
                    explosion.style.background = 'radial-gradient(circle, #ff6600 0%, #ff3300 50%, transparent 70%)';
                    document.querySelector('.arena').appendChild(explosion);
                    
                    setTimeout(() => {
                        explosion.remove();
                    }, 300);
                }
            }, 50);
        }
        
        // ============================================
        // L√ìGICA DO JOGO
        // ============================================
        
        function checkHit(isPlayer) {
            const distance = Math.abs(player.position - enemy.position);
            
            // Verificar se os personagens est√£o em posi√ß√£o de ataque
            if (isPlayer) {
                return distance < 25 && !enemy.isJumping;
            } else {
                return distance < 25 && !player.isJumping;
            }
        }
        
        function dealDamage(target, damage, isPlayerAttacking) {
            if (!gameActive) return;
            
            target.health = Math.max(0, target.health - damage);
            
            // Atualizar barra de vida
            if (target === player) {
                playerHealth.style.width = `${(player.health / player.maxHealth) * 100}%`;
                
                // Efeito visual de dano
                playerElement.style.filter = 'brightness(1.5)';
                setTimeout(() => {
                    playerElement.style.filter = '';
                }, 100);
            } else {
                enemyHealth.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
                
                // Efeito visual de dano
                enemyElement.style.filter = 'brightness(1.5)';
                setTimeout(() => {
                    enemyElement.style.filter = '';
                }, 100);
            }
            
            // Verificar vit√≥ria/derrota
            checkGameOver();
        }
        
        function updateEnergyBars() {
            playerEnergy.style.width = `${player.energy}%`;
            enemyEnergy.style.width = `${enemy.energy}%`;
            
            // Atualizar bot√£o de magia
            if (player.energy >= 100) {
                magicBtn.classList.add('ready');
                magicBtn.innerHTML = `
                    <div class="attack-icon">üî•</div>
                    <div class="attack-label">MAGIA PRONTA!</div>
                `;
            } else {
                magicBtn.classList.remove('ready');
                magicBtn.innerHTML = `
                    <div class="attack-icon">üî•</div>
                    <div class="attack-label">MAGIA (${player.energy}%)</div>
                `;
            }
        }
        
        // ============================================
        // IA DO INIMIGO
        // ============================================
        
        function startEnemyAI() {
            if (!gameActive) return;
            
            const aiInterval = setInterval(() => {
                if (!gameActive) {
                    clearInterval(aiInterval);
                    return;
                }
                
                // Tomar decis√£o baseada no n√≠vel
                const decision = Math.random() * 100;
                const distance = Math.abs(player.position - enemy.position);
                
                if (enemy.energy >= 100 && decision < 10) {
                    // Usar magia
                    fireball(false);
                } else if (distance < 20 && decision < 40) {
                    // Atacar
                    if (decision < 20) {
                        punch(false);
                    } else {
                        kick(false);
                    }
                } else if (distance > 30 && decision < 60) {
                    // Aproximar
                    moveEnemyTowardPlayer();
                } else if (distance < 15 && decision < 70) {
                    // Afastar
                    moveEnemyAway();
                } else if (decision < 80) {
                    // Defender/pular
                    if (Math.random() < 0.5) {
                        jump(false);
                    } else {
                        crouch(true, false);
                        setTimeout(() => {
                            crouch(false, false);
                        }, 1000);
                    }
                }
                
                // A IA tamb√©m ganha energia com o tempo
                enemy.energy = Math.min(enemy.energy + 1, enemy.maxEnergy);
                updateEnergyBars();
                
            }, config.enemySpeed);
        }
        
        function moveEnemyTowardPlayer() {
            if (enemy.position > player.position + 10) {
                enemy.position -= 5;
            } else if (enemy.position < player.position - 10) {
                enemy.position += 5;
            }
            
            enemy.position = Math.max(10, Math.min(90, enemy.position));
            enemyElement.style.transition = 'right 0.3s';
            enemyElement.style.right = `${100 - enemy.position}%`;
            
            updatePositions();
        }
        
        function moveEnemyAway() {
            if (enemy.position < player.position) {
                enemy.position -= 5;
            } else {
                enemy.position += 5;
            }
            
            enemy.position = Math.max(10, Math.min(90, enemy.position));
            enemyElement.style.transition = 'right 0.3s';
            enemyElement.style.right = `${100 - enemy.position}%`;
            
            updatePositions();
        }
        
        // ============================================
        // TEMPORIZADOR E CONTROLE DO JOGO
        // ============================================
        
        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame('time');
                }
            }, 1000);
        }
        
        function checkGameOver() {
            if (player.health <= 0) {
                endGame('lose');
                return true;
            }
            
            if (enemy.health <= 0) {
                endGame('win');
                return true;
            }
            
            return false;
        }
        
        function endGame(result) {
            gameActive = false;
            clearInterval(gameTimer);
            
            let messageText = "";
            let messageClass = "";
            
            switch(result) {
                case 'win':
                    messageText = "VIT√ìRIA!";
                    messageClass = "win-message";
                    setTimeout(() => {
                        saveProgress();
                        showMessage("N√çVEL COMPLETO!", 2000);
                        setTimeout(() => {
                            returnToLevelSelect();
                        }, 2500);
                    }, 2000);
                    break;
                    
                case 'lose':
                    messageText = "DERROTA";
                    messageClass = "lose-message";
                    setTimeout(() => {
                        showMessage("TENTE NOVAMENTE", 2000);
                        setTimeout(() => {
                            returnToLevelSelect();
                        }, 2500);
                    }, 2000);
                    break;
                    
                case 'time':
                    messageText = "TEMPO ESGOTADO";
                    messageClass = "lose-message";
                    setTimeout(() => {
                        returnToLevelSelect();
                    }, 2000);
                    break;
            }
            
            message.textContent = messageText;
            message.className = `message ${messageClass}`;
            message.style.opacity = '1';
            message.style.animation = 'none';
            
            setTimeout(() => {
                message.style.opacity = '0';
            }, 1500);
        }
        
        function saveProgress() {
            // Salvar progresso no localStorage
            const savedLevel = localStorage.getItem('combatTitans_currentLevel');
            if (!savedLevel || currentLevel >= parseInt(savedLevel)) {
                localStorage.setItem('combatTitans_currentLevel', currentLevel + 1);
            }
        }
        
        function showMessage(text, duration = 1000) {
            message.textContent = text;
            message.style.opacity = '1';
            
            setTimeout(() => {
                message.style.opacity = '0';
            }, duration);
        }
        
        function returnToLevelSelect() {
            window.location.href = 'level-select.html';
        }
        
        // ============================================
        // INICIAR O JOGO
        // ============================================
        
        // Quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
        });
        
        // Prevenir comportamento padr√£o de toque
        document.addEventListener('touchstart', (e) => {
            if (e.target.tagName === 'BUTTON') {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Atualizar energia gradualmente
        setInterval(() => {
            if (gameActive) {
                player.energy = Math.min(player.energy + 0.5, player.maxEnergy);
                updateEnergyBars();
            }
        }, 500);
    </script>
</body>
</html>
