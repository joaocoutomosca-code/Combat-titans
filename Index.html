<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SHADOW ROBO FIGHT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        body {
            background: #000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            height: 100vh;
            width: 100vw;
        }
        
        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 100%);
            transform: rotate(90deg);
            transform-origin: center;
            width: 100vh;
            height: 100vw;
            left: calc(50% - 50vh);
            top: calc(50% - 50vw);
        }
        
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #gameCanvas {
            z-index: 2;
            width: 100%;
            height: 100%;
        }
        
        #uiCanvas {
            z-index: 3;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        /* Botões de Controle */
        .controls {
            position: absolute;
            bottom: 30px;
            pointer-events: auto;
            z-index: 4;
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 20px;
        }
        
        .left-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .right-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: flex-end;
        }
        
        .action-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(52, 152, 219, 0.9);
            border: 3px solid rgba(255, 255, 255, 0.7);
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            text-align: center;
            line-height: 1.2;
            user-select: none;
            touch-action: manipulation;
        }
        
        .action-button:active {
            transform: scale(0.95);
            background: rgba(41, 128, 185, 0.9);
        }
        
        #kickBtn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        #punchBtn {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }
        
        #jumpBtn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .joystick-container {
            width: 140px;
            height: 140px;
            position: relative;
        }
        
        .joystick-base {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        .joystick-handle {
            width: 70px;
            height: 70px;
            background: rgba(52, 152, 219, 0.9);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 3px solid rgba(255, 255, 255, 0.5);
            transition: transform 0.05s;
        }
        
        /* UI Superior */
        .top-ui {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            z-index: 4;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            pointer-events: none;
        }
        
        .health-bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 60%;
        }
        
        .health-bar {
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .health-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        #player1HealthFill {
            background: linear-gradient(to right, #3498db, #2980b9);
            width: 100%;
        }
        
        #player2HealthFill {
            background: linear-gradient(to left, #e74c3c, #c0392b);
            width: 100%;
            float: right;
        }
        
        .player-name {
            color: white;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 5px;
        }
        
        .round-info {
            color: #f1c40f;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        #pauseBtn {
            pointer-events: auto;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: rgba(241, 196, 15, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Menus */
        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #f1c40f;
            z-index: 10;
            display: none;
            min-width: 300px;
            text-align: center;
        }
        
        .menu h2 {
            color: #f1c40f;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .menu-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .menu-button:hover {
            background: #2980b9;
        }
        
        .hit-effect {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 0, 0, 0.7);
            pointer-events: none;
            z-index: 5;
        }
        
        /* Mensagens de Status */
        .status-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: #f1c40f;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            z-index: 6;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <canvas id="uiCanvas"></canvas>
        
        <!-- UI Superior -->
        <div class="top-ui">
            <div class="health-bars">
                <div>
                    <div class="player-name">CYBER-WARRIOR</div>
                    <div class="health-bar">
                        <div class="health-fill" id="player1HealthFill"></div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div class="player-name">SHADOW-ROBO</div>
                    <div class="health-bar">
                        <div class="health-fill" id="player2HealthFill"></div>
                    </div>
                </div>
            </div>
            
            <div class="round-info">
                <div id="roundText">ROUND 1</div>
                <div id="timerText">99</div>
            </div>
            
            <button id="pauseBtn">II</button>
        </div>
        
        <!-- Controles -->
        <div class="controls">
            <div class="left-controls">
                <div class="joystick-container">
                    <div class="joystick-base"></div>
                    <div class="joystick-handle" id="joystickHandle"></div>
                </div>
                <button class="action-button" id="jumpBtn">PULAR</button>
            </div>
            
            <div class="right-controls">
                <button class="action-button" id="kickBtn">CHUTE<br>(15%)</button>
                <button class="action-button" id="punchBtn">SOCO<br>(10%)</button>
            </div>
        </div>
        
        <!-- Mensagens -->
        <div id="fightText" class="status-message">FIGHT!</div>
        <div id="koText" class="status-message">K.O!</div>
        <div id="winText" class="status-message">VITÓRIA!</div>
        
        <!-- Menu de Pause -->
        <div id="pauseMenu" class="menu">
            <h2>JOGO PAUSADO</h2>
            <button class="menu-button" id="resumeBtn">CONTINUAR</button>
            <button class="menu-button" id="restartBtn">REINICIAR</button>
            <button class="menu-button" id="soundBtn">SOM: ON</button>
        </div>
    </div>

    <!-- Sons -->
    <audio id="punchSound" src="https://assets.mixkit.co/sfx/preview/mixkit-boxing-punch-2051.mp3"></audio>
    <audio id="kickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-martial-arts-fast-punch-2056.mp3"></audio>
    <audio id="hitSound" src="https://assets.mixkit.co/sfx/preview/mixkit-boxer-getting-hit-2055.mp3"></audio>
    <audio id="jumpSound" src="https://assets.mixkit.co/sfx/preview/mixkit-player-jumping-in-a-video-game-2043.mp3"></audio>
    <audio id="bgMusic" loop src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-667.mp3"></audio>
    <audio id="koSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>

    <script>
        // Configurações
        const config = {
            canvasWidth: 0,
            canvasHeight: 0,
            groundLevel: 0.85,
            gravity: 0.8,
            jumpForce: -18,
            walkSpeed: 8,
            runSpeed: 12,
            punchDamage: 30,
            kickDamage: 45,
            punchRange: 70,
            kickRange: 85,
            roundTime: 99,
            maxHealth: 300
        };

        // Estado do Jogo
        const gameState = {
            isPaused: false,
            isFighting: false,
            round: 1,
            roundTime: config.roundTime,
            scores: [0, 0],
            soundEnabled: true,
            joystick: {
                isActive: false,
                x: 0,
                y: 0,
                baseX: 0,
                baseY: 0,
                maxDistance: 60
            },
            hitEffects: []
        };

        // Personagens
        class Character {
            constructor(x, color, name, isPlayer) {
                this.x = x;
                this.y = 0;
                this.width = 70;
                this.height = 160;
                this.velocityX = 0;
                this.velocityY = 0;
                this.health = config.maxHealth;
                this.maxHealth = config.maxHealth;
                this.color = color;
                this.name = name;
                this.direction = isPlayer ? 1 : -1;
                this.isJumping = false;
                this.isCrouching = false;
                this.isPunching = false;
                this.isKicking = false;
                this.isBlocking = false;
                this.animationTimer = 0;
                this.attackTimer = 0;
                this.walkCycle = 0;
                this.frame = 0;
                this.isPlayer = isPlayer;
                this.legsAngle = 0;
                this.armsAngle = 0;
            }

            update() {
                // Aplicar gravidade
                this.velocityY += config.gravity;
                this.y += this.velocityY;

                // Movimento horizontal
                this.x += this.velocityX;
                
                // Limites da tela
                const minX = this.width / 2;
                const maxX = config.canvasWidth - this.width / 2;
                this.x = Math.max(minX, Math.min(maxX, this.x));

                // Colisão com chão
                const groundY = config.canvasHeight * config.groundLevel - this.height;
                if (this.y > groundY) {
                    this.y = groundY;
                    this.velocityY = 0;
                    this.isJumping = false;
                }

                // Atualizar animações
                this.animationTimer++;
                if (this.velocityX !== 0 && !this.isJumping) {
                    this.walkCycle = (this.walkCycle + 1) % 30;
                }

                // Atualizar timers de ataque
                if (this.attackTimer > 0) {
                    this.attackTimer--;
                    if (this.attackTimer === 0) {
                        this.isPunching = false;
                        this.isKicking = false;
                    }
                }

                // Atualizar ângulos para animação
                if (!this.isJumping) {
                    this.legsAngle = Math.sin(this.walkCycle * 0.2) * 30;
                    this.armsAngle = Math.sin(this.walkCycle * 0.2) * 20;
                } else {
                    this.legsAngle = 45;
                    this.armsAngle = -30;
                }

                // Fricção
                this.velocityX *= 0.85;
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.direction, 1);

                // Corpo
                ctx.fillStyle = this.color;
                this.drawBody(ctx);

                // Cabeça de robô
                this.drawHead(ctx);

                // Braços
                this.drawArms(ctx);

                // Pernas
                this.drawLegs(ctx);

                // Efeitos de ataque
                if (this.isPunching) {
                    this.drawPunchEffect(ctx);
                } else if (this.isKicking) {
                    this.drawKickEffect(ctx);
                }

                ctx.restore();
            }

            drawBody(ctx) {
                // Torso
                ctx.fillStyle = this.color;
                ctx.fillRect(-25, 0, 50, 80);
                
                // Detalhes do torso
                ctx.fillStyle = '#2c3e50';
                ctx.fillRect(-20, 10, 40, 60);
                
                // Luzes no peito
                ctx.fillStyle = '#00ff00';
                ctx.beginPath();
                ctx.arc(0, 40, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ff0000';
                ctx.beginPath();
                ctx.arc(-10, 40, 5, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#0000ff';
                ctx.beginPath();
                ctx.arc(10, 40, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            drawHead(ctx) {
                // Cabeça de robô
                ctx.fillStyle = '#34495e';
                ctx.beginPath();
                ctx.arc(0, -20, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // Visor
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(0, -20, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // Detalhes do visor
                ctx.fillStyle = '#1a5276';
                ctx.beginPath();
                ctx.arc(0, -20, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // Olhos
                ctx.fillStyle = '#00ff00';
                ctx.beginPath();
                ctx.arc(-8, -25, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(8, -25, 4, 0, Math.PI * 2);
                ctx.fill();
            }

            drawArms(ctx) {
                const armAngle = this.isPunching ? 90 : this.armsAngle;
                
                // Braço esquerdo
                ctx.save();
                ctx.rotate(armAngle * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(-40, 20, 40, 15);
                ctx.restore();
                
                // Braço direito
                ctx.save();
                ctx.rotate(-armAngle * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(0, 20, 40, 15);
                ctx.restore();
                
                // Mãos
                ctx.fillStyle = '#2c3e50';
                ctx.beginPath();
                ctx.arc(-40 * Math.cos(armAngle * Math.PI / 180), 
                       20 + 40 * Math.sin(armAngle * Math.PI / 180), 10, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(40 * Math.cos(armAngle * Math.PI / 180), 
                       20 + 40 * Math.sin(armAngle * Math.PI / 180), 10, 0, Math.PI * 2);
                ctx.fill();
            }

            drawLegs(ctx) {
                const legAngle = this.isKicking ? 60 : this.legsAngle;
                
                // Perna esquerda
                ctx.save();
                ctx.rotate(legAngle * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(-15, 80, 15, 60);
                ctx.restore();
                
                // Perna direita
                ctx.save();
                ctx.rotate(-legAngle * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(0, 80, 15, 60);
                ctx.restore();
                
                // Pés
                ctx.fillStyle = '#2c3e50';
                ctx.fillRect(-25, 140, 20, 10);
                ctx.fillRect(5, 140, 20, 10);
            }

            drawPunchEffect(ctx) {
                ctx.fillStyle = 'rgba(255, 255, 0, 0.6)';
                ctx.beginPath();
                ctx.arc(70, 30, 25, 0, Math.PI * 2);
                ctx.fill();
            }

            drawKickEffect(ctx) {
                ctx.fillStyle = 'rgba(255, 100, 0, 0.6)';
                ctx.beginPath();
                ctx.arc(40, 120, 30, 0, Math.PI * 2);
                ctx.fill();
            }

            punch() {
                if (this.attackTimer > 0) return;
                this.isPunching = true;
                this.attackTimer = 15;
                return config.punchDamage;
            }

            kick() {
                if (this.attackTimer > 0) return;
                this.isKicking = true;
                this.attackTimer = 20;
                return config.kickDamage;
            }

            jump() {
                if (!this.isJumping) {
                    this.velocityY = config.jumpForce;
                    this.isJumping = true;
                    return true;
                }
                return false;
            }

            takeDamage(damage) {
                this.health = Math.max(0, this.health - damage);
                return this.health <= 0;
            }

            isAttacking() {
                return this.isPunching || this.isKicking;
            }

            getAttackRange() {
                return this.isPunching ? config.punchRange : config.kickRange;
            }
        }

        // Variáveis globais
        let canvas, ctx, uiCanvas, uiCtx;
        let player, enemy;
        let keys = {};
        let roundTimer;
        let hitEffects = [];

        // Inicialização
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            uiCanvas = document.getElementById('uiCanvas');
            uiCtx = uiCanvas.getContext('2d');
            
            resizeCanvases();
            
            // Criar personagens
            player = new Character(config.canvasWidth * 0.3, '#3498db', 'CYBER-WARRIOR', true);
            enemy = new Character(config.canvasWidth * 0.7, '#e74c3c', 'SHADOW-ROBO', false);
            
            setupControls();
            startRound();
            gameLoop();
            
            // Iniciar música
            if (gameState.soundEnabled) {
                const bgMusic = document.getElementById('bgMusic');
                bgMusic.volume = 0.4;
                bgMusic.play();
            }
        }

        function resizeCanvases() {
            const container = document.getElementById('gameContainer');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            config.canvasWidth = width;
            config.canvasHeight = height;
            
            canvas.width = width;
            canvas.height = height;
            uiCanvas.width = width;
            uiCanvas.height = height;
        }

        function setupControls() {
            // Joystick
            const joystick = document.getElementById('joystickHandle');
            joystick.addEventListener('touchstart', startJoystick);
            joystick.addEventListener('mousedown', startJoystick);
            
            document.addEventListener('touchmove', moveJoystick);
            document.addEventListener('mousemove', moveJoystick);
            document.addEventListener('touchend', endJoystick);
            document.addEventListener('mouseup', endJoystick);
            
            // Botões de ação
            document.getElementById('punchBtn').addEventListener('touchstart', () => playerAttack('punch'));
            document.getElementById('punchBtn').addEventListener('mousedown', () => playerAttack('punch'));
            
            document.getElementById('kickBtn').addEventListener('touchstart', () => playerAttack('kick'));
            document.getElementById('kickBtn').addEventListener('mousedown', () => playerAttack('kick'));
            
            document.getElementById('jumpBtn').addEventListener('touchstart', () => player.jump() && playSound('jump'));
            document.getElementById('jumpBtn').addEventListener('mousedown', () => player.jump() && playSound('jump'));
            
            // Botão de pause
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
            document.getElementById('resumeBtn').addEventListener('click', togglePause);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.getElementById('soundBtn').addEventListener('click', toggleSound);
            
            // Redimensionamento
            window.addEventListener('resize', resizeCanvases);
        }

        // Controles do Joystick
        function startJoystick(e) {
            e.preventDefault();
            const rect = e.target.parentElement.getBoundingClientRect();
            gameState.joystick.baseX = rect.left + rect.width / 2;
            gameState.joystick.baseY = rect.top + rect.height / 2;
            gameState.joystick.isActive = true;
            updateJoystick(e);
        }

        function moveJoystick(e) {
            if (!gameState.joystick.isActive) return;
            updateJoystick(e);
        }

        function updateJoystick(e) {
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            let dx = clientX - gameState.joystick.baseX;
            let dy = clientY - gameState.joystick.baseY;
            
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance > gameState.joystick.maxDistance) {
                dx = (dx / distance) * gameState.joystick.maxDistance;
                dy = (dy / distance) * gameState.joystick.maxDistance;
            }
            
            gameState.joystick.x = dx;
            gameState.joystick.y = dy;
            
            // Atualizar joystick visual
            const handle = document.getElementById('joystickHandle');
            handle.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
            
            // Controlar personagem
            if (Math.abs(dx) > 20) {
                player.velocityX = (dx > 0 ? 1 : -1) * (Math.abs(dy) > 30 ? config.runSpeed : config.walkSpeed);
                player.direction = dx > 0 ? 1 : -1;
            } else {
                player.velocityX = 0;
            }
            
            // Agachar
            player.isCrouching = dy > 30;
        }

        function endJoystick() {
            if (!gameState.joystick.isActive) return;
            gameState.joystick.isActive = false;
            gameState.joystick.x = 0;
            gameState.joystick.y = 0;
            
            const handle = document.getElementById('joystickHandle');
            handle.style.transform = 'translate(-50%, -50%)';
            
            player.velocityX = 0;
            player.isCrouching = false;
        }

        function playerAttack(type) {
            if (gameState.isPaused || !gameState.isFighting) return;
            
            let damage = 0;
            if (type === 'punch') {
                damage = player.punch();
                playSound('punch');
            } else if (type === 'kick') {
                damage = player.kick();
                playSound('kick');
            }
            
            // Verificar colisão
            if (damage > 0) {
                checkAttackCollision(player, enemy, damage);
            }
        }

        // Sistema de Combate
        function checkAttackCollision(attacker, defender, damage) {
            const distance = Math.abs(attacker.x - defender.x);
            const attackRange = attacker.getAttackRange();
            
            if (distance < attackRange) {
                if (defender.isBlocking && !defender.isJumping) {
                    // Bloqueado
                    playSound('hit');
                    createHitEffect(defender.x, defender.y, 'block');
                } else if (defender.isAttacking()) {
                    // Clash
                    const clashDamage = damage * 0.5;
                    attacker.takeDamage(clashDamage);
                    defender.takeDamage(clashDamage);
                    playSound('hit');
                    createHitEffect((attacker.x + defender.x) / 2, attacker.y, 'clash');
                } else {
                    // Golpe conectado
                    const isKO = defender.takeDamage(damage);
                    playSound('hit');
                    createHitEffect(defender.x, defender.y, 'hit');
                    
                    // Knockback
                    defender.velocityX = attacker.direction * 10;
                    
                    if (isKO) {
                        endRound(attacker === player ? 'player' : 'enemy');
                    }
                }
                
                updateHealthBars();
            }
        }

        function updateHealthBars() {
            const playerHealth = (player.health / config.maxHealth) * 100;
            const enemyHealth = (enemy.health / config.maxHealth) * 100;
            
            document.getElementById('player1HealthFill').style.width = playerHealth + '%';
            document.getElementById('player2HealthFill').style.width = enemyHealth + '%';
        }

        // Sistema de Rounds
        function startRound() {
            gameState.isFighting = true;
            gameState.roundTime = config.roundTime;
            
            // Resetar personagens
            player.health = config.maxHealth;
            enemy.health = config.maxHealth;
            player.x = config.canvasWidth * 0.3;
            enemy.x = config.canvasWidth * 0.7;
            player.y = enemy.y = 0;
            
            updateHealthBars();
            showMessage('fight', 2000);
            
            // Atualizar texto do round
            document.getElementById('roundText').textContent = `ROUND ${gameState.round}`;
            
            // Iniciar timer
            clearInterval(roundTimer);
            roundTimer = setInterval(updateRoundTimer, 1000);
        }

        function updateRoundTimer() {
            if (gameState.isPaused || !gameState.isFighting) return;
            
            gameState.roundTime--;
            document.getElementById('timerText').textContent = gameState.roundTime;
            
            if (gameState.roundTime <= 0) {
                endRound('timeout');
            }
        }

        function endRound(winner) {
            gameState.isFighting = false;
            clearInterval(roundTimer);
            
            if (winner === 'player') {
                gameState.scores[0]++;
                showMessage('ko', 2000);
            } else if (winner === 'enemy') {
                gameState.scores[1]++;
                showMessage('ko', 2000);
            } else {
                // Timeout - quem tem mais vida vence
                if (player.health > enemy.health) {
                    gameState.scores[0]++;
                } else if (enemy.health > player.health) {
                    gameState.scores[1]++;
                }
            }
            
            // Verificar fim do jogo
            if (gameState.scores[0] >= 2 || gameState.scores[1] >= 2 || gameState.round >= 3) {
                setTimeout(endGame, 3000);
            } else {
                gameState.round++;
                setTimeout(startRound, 3000);
            }
        }

        function endGame() {
            showMessage('win', 3000);
            setTimeout(() => {
                alert(`JOGO FINALIZADO!\n\nCYBER-WARRIOR: ${gameState.scores[0]}\nSHADOW-ROBO: ${gameState.scores[1]}`);
                restartGame();
            }, 3000);
        }

        // IA do Inimigo
        function updateAI() {
            if (!gameState.isFighting || gameState.isPaused) return;
            
            const distance = Math.abs(player.x - enemy.x);
            
            // Movimentação
            if (distance > 200) {
                // Se estiver longe, aproximar
                enemy.velocityX = (player.x > enemy.x ? 1 : -1) * config.walkSpeed;
                enemy.direction = player.x > enemy.x ? 1 : -1;
            } else if (distance < 100) {
                // Se estiver perto, recuar
                enemy.velocityX = (player.x > enemy.x ? -1 : 1) * config.walkSpeed;
            } else {
                enemy.velocityX = 0;
            }
            
            // Decidir ataque
            if (distance < config.kickRange + 50) {
                const attackChance = Math.random();
                if (attackChance < 0.02) { // 2% de chance por frame
                    if (distance < config.punchRange && Math.random() > 0.5) {
                        const damage = enemy.punch();
                        if (damage > 0) {
                            playSound('punch');
                            checkAttackCollision(enemy, player, damage);
                        }
                    } else if (distance < config.kickRange) {
                        const damage = enemy.kick();
                        if (damage > 0) {
                            playSound('kick');
                            checkAttackCollision(enemy, player, damage);
                        }
                    }
                }
            }
            
            // Pular ocasionalmente
            if (Math.random() < 0.005 && !enemy.isJumping) {
                enemy.jump();
                playSound('jump');
            }
        }

        // Efeitos Visuais
        function createHitEffect(x, y, type) {
            hitEffects.push({
                x: x,
                y: y - 50,
                type: type,
                size: 30,
                alpha: 1.0,
                life: 30
            });
        }

        function updateHitEffects() {
            for (let i = hitEffects.length - 1; i >= 0; i--) {
                const effect = hitEffects[i];
                effect.life--;
                effect.alpha = effect.life / 30;
                effect.size += 1;
                
                if (effect.life <= 0) {
                    hitEffects.splice(i, 1);
                }
            }
        }

        function drawHitEffects() {
            hitEffects.forEach(effect => {
                uiCtx.save();
                uiCtx.globalAlpha = effect.alpha;
                
                if (effect.type === 'hit') {
                    uiCtx.fillStyle = '#ff0000';
                } else if (effect.type === 'block') {
                    uiCtx.fillStyle = '#3498db';
                } else {
                    uiCtx.fillStyle = '#ffff00';
                }
                
                uiCtx.beginPath();
                uiCtx.arc(effect.x, effect.y, effect.size, 0, Math.PI * 2);
                uiCtx.fill();
                
                uiCtx.restore();
            });
        }

        // Sistema de Mensagens
        function showMessage(type, duration) {
            const messages = {
                'fight': document.getElementById('fightText'),
                'ko': document.getElementById('koText'),
                'win': document.getElementById('winText')
            };
            
            Object.values(messages).forEach(msg => msg.style.opacity = '0');
            
            if (messages[type]) {
                messages[type].style.opacity = '1';
                
                if (type === 'ko') playSound('ko');
                if (type === 'win') playSound('ko');
                
                setTimeout(() => {
                    messages[type].style.opacity = '0';
                }, duration);
            }
        }

        // Sistema de Som
        function playSound(soundName) {
            if (!gameState.soundEnabled) return;
            
            const audio = document.getElementById(soundName + 'Sound');
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log("Som bloqueado"));
            }
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const btn = document.getElementById('soundBtn');
            btn.textContent = gameState.soundEnabled ? 'SOM: ON' : 'SOM: OFF';
            
            const bgMusic = document.getElementById('bgMusic');
            if (gameState.soundEnabled) {
                bgMusic.play();
            } else {
                bgMusic.pause();
            }
        }

        // Controles de Jogo
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            const menu = document.getElementById('pauseMenu');
            
            if (gameState.isPaused) {
                menu.style.display = 'block';
                document.getElementById('bgMusic').pause();
            } else {
                menu.style.display = 'none';
                if (gameState.soundEnabled) {
                    document.getElementById('bgMusic').play();
                }
            }
        }

        function restartGame() {
            gameState.round = 1;
            gameState.scores = [0, 0];
            gameState.isPaused = false;
            gameState.isFighting = false;
            
            document.getElementById('pauseMenu').style.display = 'none';
            startRound();
        }

        // Renderização
        function drawBackground() {
            // Céu noturno
            const gradient = ctx.createLinearGradient(0, 0, 0, config.canvasHeight);
            gradient.addColorStop(0, '#0c2461');
            gradient.addColorStop(1, '#1e3799');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, config.canvasWidth, config.canvasHeight);
            
            // Chão
            const groundY = config.canvasHeight * config.groundLevel;
            ctx.fillStyle = '#2d3436';
            ctx.fillRect(0, groundY, config.canvasWidth, config.canvasHeight - groundY);
            
            // Detalhes do chão
            ctx.fillStyle = '#636e72';
            for (let i = 0; i < config.canvasWidth; i += 60) {
                ctx.fillRect(i, groundY, 30, 5);
            }
            
            // Luzes
            const lightGradient = ctx.createRadialGradient(
                config.canvasWidth / 2, groundY - 100, 0,
                config.canvasWidth / 2, groundY - 100, 400
            );
            lightGradient.addColorStop(0, 'rgba(241, 196, 15, 0.2)');
            lightGradient.addColorStop(1, 'rgba(241, 196, 15, 0)');
            ctx.fillStyle = lightGradient;
            ctx.fillRect(0, 0, config.canvasWidth, groundY);
        }

        function drawUI() {
            uiCtx.clearRect(0, 0, config.canvasWidth, config.canvasHeight);
            drawHitEffects();
        }

        // Loop Principal
        function gameLoop() {
            if (!gameState.isPaused) {
                // Atualizar
                player.update();
                enemy.update();
                updateAI();
                updateHitEffects();
                
                // Renderizar
                ctx.clearRect(0, 0, config.canvasWidth, config.canvasHeight);
                drawBackground();
                player.draw(ctx);
                enemy.draw(ctx);
                drawUI();
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Inicializar quando a página carregar
        window.addEventListener('load', init);
        
        // Prevenir zoom e scroll
        document.addEventListener('touchmove', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'CANVAS') {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
    </html>
